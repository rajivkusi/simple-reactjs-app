name: Get Last Merged PR Info

on:
  push:
    branches:
      - master  # Change this to match your default branch

jobs:
  get-last-merged-pr-info:
    runs-on: ubuntu-latest

    steps:
      - name: Checkout code
        uses: actions/checkout@v2
      
      - name: Get Last Merged PR Info
        id: get_last_merged_pr
        run: |
          TOKEN="${{ secrets.GH_TOKEN }}"
          REPO_OWNER="${{ github.repository_owner }}"
          REPO_NAME="${{ github.repository }}"
          PR_URL=$(curl -sSL -H "Authorization: token $TOKEN" "https://api.github.com/repos/$REPO_OWNER/$REPO_NAME/pulls?state=closed" | jq '.[] | select(.merged_at != null) | .')
          COMMITS_URL=$(curl -sSL -H "Authorization: token $TOKEN" "$PR_URL/commits" | jq -r '.[0].url')
          LATEST_COMMIT=$(curl -sSL -H "Authorization: token $TOKEN" "$COMMITS_URL")


          echo "::set-output name=last_pr_info::$LAST_PR_INFO"
          echo $LAST_PR_INFO
          echo $LATEST_COMMIT
      
      # - name: Output Last Merged PR Info
      #   run: echo "Last Merged PR Info: ${{ steps.get_last_merged_pr.outputs.last_pr_info }}"





# name: Build and Deploy

# on:
#   push:
#     branches:
#       - master
# jobs:
#   download:
#     runs-on: ubuntu-latest
#     permissions: 
#       actions: read
#     steps:
#     - name: Download All Artifacts
#       id: download-artifact
#       uses: dawidd6/action-download-artifact@v3
#       with:
#   #       github_token: ${{secrets.GH_TOKEN}}
#          workflow: main.yml
#          name: ci-data
#          check_artifacts: true
#          search_artifacts: true
#     - run: cat ci.json






  #     uses: actions/download-artifact@v4
  #     with:
  # #      path: my-artifact
  #       name: ci-data #my-artifact-*
  # #      merge-multiple: true
  #       github-token: ${{ secrets.GH_TOKEN }}
  #       check_artifacts: true
  #       search_artifacts: true
  #   - run: cat ci.json